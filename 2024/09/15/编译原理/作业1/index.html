<!DOCTYPE html><html lang="Chinese" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>作业1 | MoYingXing</title><meta name="author" content="陌影形"><meta name="copyright" content="陌影形"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="一c++示例#include &lt;stdio.h&gt;#include &lt;math.h&gt;#define PI 3.14159265358979323846const int maxValue &#x3D; 100;int globalVar &#x3D; 10;int square(int x) &#123;    return x * x;&#125;void printResult(double">
<meta property="og:type" content="article">
<meta property="og:title" content="作业1">
<meta property="og:url" content="http://example.com/2024/09/15/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/%E4%BD%9C%E4%B8%9A1/index.html">
<meta property="og:site_name" content="MoYingXing">
<meta property="og:description" content="一c++示例#include &lt;stdio.h&gt;#include &lt;math.h&gt;#define PI 3.14159265358979323846const int maxValue &#x3D; 100;int globalVar &#x3D; 10;int square(int x) &#123;    return x * x;&#125;void printResult(double">
<meta property="og:locale">
<meta property="og:image" content="https://avatars.githubusercontent.com/u/162703063?s=400&u=7f599e5661244ad7e8490354a9580880dc56acde&v=4">
<meta property="article:published_time" content="2024-09-15T09:45:08.000Z">
<meta property="article:modified_time" content="2024-09-23T05:10:04.000Z">
<meta property="article:author" content="陌影形">
<meta property="article:tag" content="compiler">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://avatars.githubusercontent.com/u/162703063?s=400&u=7f599e5661244ad7e8490354a9580880dc56acde&v=4"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2024/09/15/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/%E4%BD%9C%E4%B8%9A1/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Error',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '作业1',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-09-23 13:10:04'
}</script><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
        if (t === 'dark') activateDarkMode()
        else if (t === 'light') activateLightMode()
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://avatars.githubusercontent.com/u/162703063?s=400&amp;u=7f599e5661244ad7e8490354a9580880dc56acde&amp;v=4" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">53</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">17</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/img/cov.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="MoYingXing"><img class="site-icon" src="/img/favicon.png"/><span class="site-name">MoYingXing</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-list"></i><span> List</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> Music</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> Movie</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">作业1</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2024-09-15T09:45:08.000Z" title="Created 2024-09-15 17:45:08">2024-09-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2024-09-23T05:10:04.000Z" title="Updated 2024-09-23 13:10:04">2024-09-23</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/compiler/">compiler</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="作业1"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="一"><a href="#一" class="headerlink" title="一"></a>一</h2><h2 id="c-示例"><a href="#c-示例" class="headerlink" title="c++示例"></a>c++示例</h2><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;math.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PI 3.14159265358979323846</span></span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxValue = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> globalVar = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">square</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printResult</span><span class="params">(<span class="type">double</span> radius)</span> &#123;</span><br><span class="line">    <span class="type">double</span> area = PI * square(radius);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Area of the circle with radius %.2f is %.2f\n&quot;</span>, radius, area);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">double</span> radius = <span class="number">5.0</span>;</span><br><span class="line">    printResult(radius);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; maxValue; i++) &#123;</span><br><span class="line">        globalVar += i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Final globalVar value: %d\n&quot;</span>, globalVar);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="1预处理"><a href="#1预处理" class="headerlink" title="1预处理"></a>1预处理</h3><blockquote>
<p>主要涉及到：1.头文件展开，基本上就是copy，头文件中包含了外部函数的声明，和一些结构体的定义。</p>
<p>2.宏替换（copy）</p>
</blockquote>
<blockquote>
<p>sh：</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">cpp ex.c -o example.i</span><br><span class="line"><span class="comment">## 扩展</span></span><br><span class="line">cpp -DPI=3.14 example.c -o example.i</span><br><span class="line">cpp -nostdinc example.c -o example.i</span><br><span class="line">cpp -dM example.c</span><br><span class="line">	</span><br></pre></td></tr></table></figure>

<blockquote>
<p>处理结果</p>
</blockquote>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*头文件部分</span></span><br><span class="line"><span class="comment">*预处理器在处理头文件和代码时生成的注释，用来跟踪源代码中每个部分的来源。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"># <span class="number">0</span> <span class="string">&quot;ex.c&quot;</span></span><br><span class="line">....................................................................................</span><br><span class="line"># <span class="number">1</span> <span class="string">&quot;/usr/include/x86_64-linux-gnu/gnu/stubs-64.h&quot;</span> <span class="number">1</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"># <span class="number">11</span> <span class="string">&quot;/usr/include/x86_64-linux-gnu/gnu/stubs.h&quot;</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"># <span class="number">511</span> <span class="string">&quot;/usr/include/features.h&quot;</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"># <span class="number">34</span> <span class="string">&quot;/usr/include/x86_64-linux-gnu/bits/libc-header-start.h&quot;</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"># <span class="number">28</span> <span class="string">&quot;/usr/include/stdio.h&quot;</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"></span><br><span class="line">....................................................................................</span><br><span class="line"><span class="comment">/*头文件部分</span></span><br><span class="line"><span class="comment">*库结构体定义</span></span><br><span class="line"><span class="comment">*以iofile为例，这个就是库中的输入输出的底层实现的结构体</span></span><br><span class="line"><span class="comment">*其中包含这缓冲区指针等等。</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> __<span class="title">FILE</span>;</span></span><br><span class="line"># <span class="number">42</span> <span class="string">&quot;/usr/include/stdio.h&quot;</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"># <span class="number">1</span> <span class="string">&quot;/usr/include/x86_64-linux-gnu/bits/types/FILE.h&quot;</span> <span class="number">1</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span>；</span></span><br><span class="line"><span class="class"><span class="title">typedef</span> <span class="keyword">struct</span> _<span class="title">IO_FILE</span> <span class="title">FILE</span>;</span></span><br><span class="line"># <span class="number">43</span> <span class="string">&quot;/usr/include/stdio.h&quot;</span> <span class="number">2</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"># <span class="number">1</span> <span class="string">&quot;/usr/include/x86_64-linux-gnu/bits/types/struct_FILE.h&quot;</span> <span class="number">1</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"># <span class="number">35</span> <span class="string">&quot;/usr/include/x86_64-linux-gnu/bits/types/struct_FILE.h&quot;</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_marker</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_codecvt</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_wide_data</span>;</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="type">void</span> _IO_lock_t;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="type">int</span> _flags;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="type">char</span> *_IO_read_ptr;</span><br><span class="line">  <span class="type">char</span> *_IO_read_end;</span><br><span class="line">  <span class="type">char</span> *_IO_read_base;</span><br><span class="line">  <span class="type">char</span> *_IO_write_base;</span><br><span class="line">  <span class="type">char</span> *_IO_write_ptr;</span><br><span class="line">  <span class="type">char</span> *_IO_write_end;</span><br><span class="line">  <span class="type">char</span> *_IO_buf_base;</span><br><span class="line">  <span class="type">char</span> *_IO_buf_end;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="type">char</span> *_IO_save_base;</span><br><span class="line">  <span class="type">char</span> *_IO_backup_base;</span><br><span class="line">  <span class="type">char</span> *_IO_save_end;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_marker</span> *_<span class="title">markers</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">chain</span>;</span></span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> _fileno;</span><br><span class="line">  <span class="type">int</span> _flags2;</span><br><span class="line">  <span class="type">__off_t</span> _old_offset;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">short</span> _cur_column;</span><br><span class="line">  <span class="type">signed</span> <span class="type">char</span> _vtable_offset;</span><br><span class="line">  <span class="type">char</span> _shortbuf[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">  _IO_lock_t *_lock;</span><br><span class="line">  <span class="type">__off64_t</span> _offset;</span><br><span class="line"></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_codecvt</span> *_<span class="title">codecvt</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_wide_data</span> *_<span class="title">wide_data</span>;</span></span><br><span class="line">  <span class="class"><span class="keyword">struct</span> _<span class="title">IO_FILE</span> *_<span class="title">freeres_list</span>;</span></span><br><span class="line">  <span class="type">void</span> *_freeres_buf;</span><br><span class="line">  <span class="type">size_t</span> __pad5;</span><br><span class="line">  <span class="type">int</span> _mode;</span><br><span class="line"></span><br><span class="line">  <span class="type">char</span> _unused2[<span class="number">15</span> * <span class="keyword">sizeof</span> (<span class="type">int</span>) - <span class="number">4</span> * <span class="keyword">sizeof</span> (<span class="type">void</span> *) - <span class="keyword">sizeof</span> (<span class="type">size_t</span>)];</span><br><span class="line">&#125;;</span><br><span class="line">....................................................................................</span><br><span class="line"><span class="comment">/*一些函数声明*/</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> <span class="title function_">remove</span> <span class="params">(<span class="type">const</span> <span class="type">char</span> *__filename)</span> __<span class="title function_">attribute__</span> <span class="params">((__nothrow__ , __leaf__))</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> <span class="title function_">rename</span> <span class="params">(<span class="type">const</span> <span class="type">char</span> *__old, <span class="type">const</span> <span class="type">char</span> *__new)</span> __<span class="title function_">attribute__</span> <span class="params">((__nothrow__ , __leaf__))</span>;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> <span class="title function_">renameat</span> <span class="params">(<span class="type">int</span> __oldfd, <span class="type">const</span> <span class="type">char</span> *__old, <span class="type">int</span> __newfd,</span></span><br><span class="line"><span class="params">       <span class="type">const</span> <span class="type">char</span> *__new)</span> __<span class="title function_">attribute__</span> <span class="params">((__nothrow__ , __leaf__))</span>;</span><br><span class="line"># <span class="number">178</span> <span class="string">&quot;/usr/include/stdio.h&quot;</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">int</span> <span class="title function_">fclose</span> <span class="params">(FILE *__stream)</span>;</span><br><span class="line"># <span class="number">188</span> <span class="string">&quot;/usr/include/stdio.h&quot;</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"><span class="keyword">extern</span> FILE *<span class="title function_">tmpfile</span> <span class="params">(<span class="type">void</span>)</span></span><br><span class="line">  __<span class="title function_">attribute__</span> <span class="params">((__malloc__))</span> __<span class="title function_">attribute__</span> <span class="params">((__malloc__ (fclose, <span class="number">1</span>)))</span> ;</span><br><span class="line"># <span class="number">205</span> <span class="string">&quot;/usr/include/stdio.h&quot;</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> *<span class="title function_">tmpnam</span> <span class="params">(<span class="type">char</span>[<span class="number">20</span>])</span> __<span class="title function_">attribute__</span> <span class="params">((__nothrow__ , __leaf__))</span> ;</span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> *<span class="title function_">tmpnam_r</span> <span class="params">(<span class="type">char</span> __s[<span class="number">20</span>])</span> __<span class="title function_">attribute__</span> <span class="params">((__nothrow__ , __leaf__))</span> ;</span><br><span class="line"># <span class="number">222</span> <span class="string">&quot;/usr/include/stdio.h&quot;</span> <span class="number">3</span> <span class="number">4</span></span><br><span class="line"><span class="keyword">extern</span> <span class="type">char</span> *<span class="title function_">tempnam</span> <span class="params">(<span class="type">const</span> <span class="type">char</span> *__dir, <span class="type">const</span> <span class="type">char</span> *__pfx)</span></span><br><span class="line">   __<span class="title function_">attribute__</span> <span class="params">((__nothrow__ , __leaf__))</span> __<span class="title function_">attribute__</span> <span class="params">((__malloc__))</span> __<span class="title function_">attribute__</span> <span class="params">((__malloc__ (__builtin_free, <span class="number">1</span>)))</span>;</span><br><span class="line">....................................................................................</span><br><span class="line"><span class="comment">/*主程序逻辑*/</span></span><br><span class="line"># <span class="number">6</span> <span class="string">&quot;ex.c&quot;</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> maxValue = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> globalVar = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">square</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printResult</span><span class="params">(<span class="type">double</span> radius)</span> &#123;</span><br><span class="line">    <span class="type">double</span> area = <span class="number">3.14159265358979323846</span> * square(radius);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Area of the circle with radius %.2f is %.2f\n&quot;</span>, radius, area);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">double</span> radius = <span class="number">5.0</span>;</span><br><span class="line">    printResult(radius);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; maxValue; i++) &#123;</span><br><span class="line">        globalVar += i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Final globalVar value: %d\n&quot;</span>, globalVar);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2词法分析"><a href="#2词法分析" class="headerlink" title="2词法分析"></a>2词法分析</h3><blockquote>
<p>主要是用于token流的生成，为了后续的ast的实现</p>
<p><strong>[StartOfLine]</strong> 和 **[LeadingSpace]**：</p>
<ul>
<li>这些标签表示该 token 是否位于行首，或者其前面是否有空格。</li>
</ul>
<p><strong>Loc</strong>：</p>
<ul>
<li>表示 token 的来源文件和具体的行、列位置，帮助追踪每个 token 在源文件中的位置，方便调试或分析。</li>
</ul>
<p><strong>Spelling</strong>：</p>
<ul>
<li><code>Spelling=&lt;built-in&gt;</code> 表示该 token 是来自于编译器的内置定义，而不是用户代码中的内容。例如，<code>size_t</code>、<code>__builtin_va_list</code> 都是标准库或内置类型。</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">//clang -Xclang -dump-tokens -fsyntax-only ex.c &gt; mytoken 2&gt;&amp;1</span><br><span class="line">头文件的一些词法</span><br><span class="line">.....................</span><br><span class="line">const &#x27;const&#x27;	 [StartOfLine]	Loc=&lt;ex.c:6:1&gt;</span><br><span class="line">int &#x27;int&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:6:7&gt;</span><br><span class="line">identifier &#x27;maxValue&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:6:11&gt;</span><br><span class="line">equal &#x27;=&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:6:20&gt;</span><br><span class="line">numeric_constant &#x27;100&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:6:22&gt;</span><br><span class="line">semi &#x27;;&#x27;		Loc=&lt;ex.c:6:25&gt;</span><br><span class="line">int &#x27;int&#x27;	 [StartOfLine]	Loc=&lt;ex.c:8:1&gt;</span><br><span class="line">identifier &#x27;globalVar&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:8:5&gt;</span><br><span class="line">equal &#x27;=&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:8:15&gt;</span><br><span class="line">numeric_constant &#x27;10&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:8:17&gt;</span><br><span class="line">semi &#x27;;&#x27;		Loc=&lt;ex.c:8:19&gt;</span><br><span class="line">int &#x27;int&#x27;	 [StartOfLine]	Loc=&lt;ex.c:10:1&gt;</span><br><span class="line">identifier &#x27;square&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:10:5&gt;</span><br><span class="line">l_paren &#x27;(&#x27;		Loc=&lt;ex.c:10:11&gt;</span><br><span class="line">int &#x27;int&#x27;		Loc=&lt;ex.c:10:12&gt;</span><br><span class="line">identifier &#x27;x&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:10:16&gt;</span><br><span class="line">r_paren &#x27;)&#x27;		Loc=&lt;ex.c:10:17&gt;</span><br><span class="line">l_brace &#x27;&#123;&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:10:19&gt;</span><br><span class="line">return &#x27;return&#x27;	 [StartOfLine] [LeadingSpace]	Loc=&lt;ex.c:11:5&gt;</span><br><span class="line">identifier &#x27;x&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:11:12&gt;</span><br><span class="line">star &#x27;*&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:11:14&gt;</span><br><span class="line">identifier &#x27;x&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:11:16&gt;</span><br><span class="line">semi &#x27;;&#x27;		Loc=&lt;ex.c:11:17&gt;</span><br><span class="line">r_brace &#x27;&#125;&#x27;	 [StartOfLine]	Loc=&lt;ex.c:12:1&gt;</span><br><span class="line">void &#x27;void&#x27;	 [StartOfLine]	Loc=&lt;ex.c:14:1&gt;</span><br><span class="line">identifier &#x27;printResult&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:14:6&gt;</span><br><span class="line">l_paren &#x27;(&#x27;		Loc=&lt;ex.c:14:17&gt;</span><br><span class="line">double &#x27;double&#x27;		Loc=&lt;ex.c:14:18&gt;</span><br><span class="line">identifier &#x27;radius&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:14:25&gt;</span><br><span class="line">r_paren &#x27;)&#x27;		Loc=&lt;ex.c:14:31&gt;</span><br><span class="line">l_brace &#x27;&#123;&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:14:33&gt;</span><br><span class="line">double &#x27;double&#x27;	 [StartOfLine] [LeadingSpace]	Loc=&lt;ex.c:15:5&gt;</span><br><span class="line">identifier &#x27;area&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:15:12&gt;</span><br><span class="line">equal &#x27;=&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:15:17&gt;</span><br><span class="line">numeric_constant &#x27;3.14159265358979323846&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:15:19 &lt;Spelling=ex.c:4:12&gt;&gt;</span><br><span class="line">star &#x27;*&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:15:22&gt;</span><br><span class="line">identifier &#x27;square&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:15:24&gt;</span><br><span class="line">l_paren &#x27;(&#x27;		Loc=&lt;ex.c:15:30&gt;</span><br><span class="line">identifier &#x27;radius&#x27;		Loc=&lt;ex.c:15:31&gt;</span><br><span class="line">r_paren &#x27;)&#x27;		Loc=&lt;ex.c:15:37&gt;</span><br><span class="line">semi &#x27;;&#x27;		Loc=&lt;ex.c:15:38&gt;</span><br><span class="line">identifier &#x27;printf&#x27;	 [StartOfLine] [LeadingSpace]	Loc=&lt;ex.c:16:5&gt;</span><br><span class="line">l_paren &#x27;(&#x27;		Loc=&lt;ex.c:16:11&gt;</span><br><span class="line">string_literal &#x27;&quot;Area of the circle with radius %.2f is %.2f\n&quot;&#x27;		Loc=&lt;ex.c:16:12&gt;</span><br><span class="line">comma &#x27;,&#x27;		Loc=&lt;ex.c:16:59&gt;</span><br><span class="line">identifier &#x27;radius&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:16:61&gt;</span><br><span class="line">comma &#x27;,&#x27;		Loc=&lt;ex.c:16:67&gt;</span><br><span class="line">identifier &#x27;area&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:16:69&gt;</span><br><span class="line">r_paren &#x27;)&#x27;		Loc=&lt;ex.c:16:73&gt;</span><br><span class="line">semi &#x27;;&#x27;		Loc=&lt;ex.c:16:74&gt;</span><br><span class="line">r_brace &#x27;&#125;&#x27;	 [StartOfLine]	Loc=&lt;ex.c:17:1&gt;</span><br><span class="line">int &#x27;int&#x27;	 [StartOfLine]	Loc=&lt;ex.c:19:1&gt;</span><br><span class="line">identifier &#x27;main&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:19:5&gt;</span><br><span class="line">l_paren &#x27;(&#x27;		Loc=&lt;ex.c:19:9&gt;</span><br><span class="line">r_paren &#x27;)&#x27;		Loc=&lt;ex.c:19:10&gt;</span><br><span class="line">l_brace &#x27;&#123;&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:19:12&gt;</span><br><span class="line">double &#x27;double&#x27;	 [StartOfLine] [LeadingSpace]	Loc=&lt;ex.c:20:5&gt;</span><br><span class="line">identifier &#x27;radius&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:20:12&gt;</span><br><span class="line">equal &#x27;=&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:20:19&gt;</span><br><span class="line">numeric_constant &#x27;5.0&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:20:21&gt;</span><br><span class="line">semi &#x27;;&#x27;		Loc=&lt;ex.c:20:24&gt;</span><br><span class="line">identifier &#x27;printResult&#x27;	 [StartOfLine] [LeadingSpace]	Loc=&lt;ex.c:21:5&gt;</span><br><span class="line">l_paren &#x27;(&#x27;		Loc=&lt;ex.c:21:16&gt;</span><br><span class="line">identifier &#x27;radius&#x27;		Loc=&lt;ex.c:21:17&gt;</span><br><span class="line">r_paren &#x27;)&#x27;		Loc=&lt;ex.c:21:23&gt;</span><br><span class="line">semi &#x27;;&#x27;		Loc=&lt;ex.c:21:24&gt;</span><br><span class="line">for &#x27;for&#x27;	 [StartOfLine] [LeadingSpace]	Loc=&lt;ex.c:23:5&gt;</span><br><span class="line">l_paren &#x27;(&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:23:9&gt;</span><br><span class="line">int &#x27;int&#x27;		Loc=&lt;ex.c:23:10&gt;</span><br><span class="line">identifier &#x27;i&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:23:14&gt;</span><br><span class="line">equal &#x27;=&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:23:16&gt;</span><br><span class="line">numeric_constant &#x27;0&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:23:18&gt;</span><br><span class="line">semi &#x27;;&#x27;		Loc=&lt;ex.c:23:19&gt;</span><br><span class="line">identifier &#x27;i&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:23:21&gt;</span><br><span class="line">less &#x27;&lt;&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:23:23&gt;</span><br><span class="line">identifier &#x27;maxValue&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:23:25&gt;</span><br><span class="line">semi &#x27;;&#x27;		Loc=&lt;ex.c:23:33&gt;</span><br><span class="line">identifier &#x27;i&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:23:35&gt;</span><br><span class="line">plusplus &#x27;++&#x27;		Loc=&lt;ex.c:23:36&gt;</span><br><span class="line">r_paren &#x27;)&#x27;		Loc=&lt;ex.c:23:38&gt;</span><br><span class="line">l_brace &#x27;&#123;&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:23:40&gt;</span><br><span class="line">identifier &#x27;globalVar&#x27;	 [StartOfLine] [LeadingSpace]	Loc=&lt;ex.c:24:9&gt;</span><br><span class="line">plusequal &#x27;+=&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:24:19&gt;</span><br><span class="line">identifier &#x27;i&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:24:22&gt;</span><br><span class="line">semi &#x27;;&#x27;		Loc=&lt;ex.c:24:23&gt;</span><br><span class="line">r_brace &#x27;&#125;&#x27;	 [StartOfLine] [LeadingSpace]	Loc=&lt;ex.c:25:5&gt;</span><br><span class="line">identifier &#x27;printf&#x27;	 [StartOfLine] [LeadingSpace]	Loc=&lt;ex.c:26:5&gt;</span><br><span class="line">l_paren &#x27;(&#x27;		Loc=&lt;ex.c:26:11&gt;</span><br><span class="line">string_literal &#x27;&quot;Final globalVar value: %d\n&quot;&#x27;		Loc=&lt;ex.c:26:12&gt;</span><br><span class="line">comma &#x27;,&#x27;		Loc=&lt;ex.c:26:41&gt;</span><br><span class="line">identifier &#x27;globalVar&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:26:43&gt;</span><br><span class="line">r_paren &#x27;)&#x27;		Loc=&lt;ex.c:26:52&gt;</span><br><span class="line">semi &#x27;;&#x27;		Loc=&lt;ex.c:26:53&gt;</span><br><span class="line">return &#x27;return&#x27;	 [StartOfLine] [LeadingSpace]	Loc=&lt;ex.c:28:5&gt;</span><br><span class="line">numeric_constant &#x27;0&#x27;	 [LeadingSpace]	Loc=&lt;ex.c:28:12&gt;</span><br><span class="line">semi &#x27;;&#x27;		Loc=&lt;ex.c:28:13&gt;</span><br><span class="line">r_brace &#x27;&#125;&#x27;	 [StartOfLine]	Loc=&lt;ex.c:29:1&gt;</span><br><span class="line">eof &#x27;&#x27;		Loc=&lt;ex.c:29:2&gt;</span><br></pre></td></tr></table></figure>

<h3 id="3语法分析（AST生成）"><a href="#3语法分析（AST生成）" class="headerlink" title="3语法分析（AST生成）"></a>3语法分析（AST生成）</h3><blockquote>
<p>忽略了头文件的ast部分，可以看出主函数由几个声明组成，TranslationUnitDecl作为树根。</p>
<p>clang -E -Xclang -ast-dump ex.c &gt; myparse 2&gt;&amp;1</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">TranslationUnitDecl 0xa5e388 &lt;&lt;invalid sloc&gt;&gt; &lt;invalid sloc&gt;</span><br><span class="line">|-TypedefDecl 0xa5ebb0 &lt;&lt;invalid sloc&gt;&gt; &lt;invalid sloc&gt; implicit __int128_t &#x27;__int128&#x27;</span><br><span class="line">| `-BuiltinType 0xa5e950 &#x27;__int128&#x27;</span><br><span class="line">|-TypedefDecl 0xa5ec20 &lt;&lt;invalid sloc&gt;&gt; &lt;invalid sloc&gt; implicit __uint128_t &#x27;unsigned __int128&#x27;</span><br><span class="line">| `-BuiltinType 0xa5e970 &#x27;unsigned __int128&#x27;</span><br><span class="line">|-TypedefDecl 0xa5ef28 &lt;&lt;invalid sloc&gt;&gt; &lt;invalid sloc&gt; implicit __NSConstantString &#x27;struct __NSConstantString_tag&#x27;</span><br><span class="line">| `-RecordType 0xa5ed00 &#x27;struct __NSConstantString_tag&#x27;</span><br><span class="line">|   `-Record 0xa5ec78 &#x27;__NSConstantString_tag&#x27;</span><br><span class="line">|-TypedefDecl 0xa5efc0 &lt;&lt;invalid sloc&gt;&gt; &lt;invalid sloc&gt; implicit __builtin_ms_va_list &#x27;char *&#x27;</span><br><span class="line">.................................</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">|-VarDecl 0xbad2f8 &lt;ex.c:6:1, col:22&gt; col:11 used maxValue &#x27;const int&#x27; cinit</span><br><span class="line">| `-IntegerLiteral 0xbad360 &lt;col:22&gt; &#x27;int&#x27; 100</span><br><span class="line">|-VarDecl 0xbad398 &lt;line:8:1, col:17&gt; col:5 used globalVar &#x27;int&#x27; cinit</span><br><span class="line">| `-IntegerLiteral 0xbad400 &lt;col:17&gt; &#x27;int&#x27; 10</span><br><span class="line">|-FunctionDecl 0xbb4018 &lt;line:10:1, line:12:1&gt; line:10:5 used square &#x27;int (int)&#x27;</span><br><span class="line">| |-ParmVarDecl 0xbb3f80 &lt;col:12, col:16&gt; col:16 used x &#x27;int&#x27;</span><br><span class="line">| `-CompoundStmt 0xbb4160 &lt;col:19, line:12:1&gt;</span><br><span class="line">|   `-ReturnStmt 0xbb4150 &lt;line:11:5, col:16&gt;</span><br><span class="line">|     `-BinaryOperator 0xbb4130 &lt;col:12, col:16&gt; &#x27;int&#x27; &#x27;*&#x27;</span><br><span class="line">|       |-ImplicitCastExpr 0xbb4100 &lt;col:12&gt; &#x27;int&#x27; &lt;LValueToRValue&gt;</span><br><span class="line">|       | `-DeclRefExpr 0xbb40c0 &lt;col:12&gt; &#x27;int&#x27; lvalue ParmVar 0xbb3f80 &#x27;x&#x27; &#x27;int&#x27;</span><br><span class="line">|       `-ImplicitCastExpr 0xbb4118 &lt;col:16&gt; &#x27;int&#x27; &lt;LValueToRValue&gt;</span><br><span class="line">|         `-DeclRefExpr 0xbb40e0 &lt;col:16&gt; &#x27;int&#x27; lvalue ParmVar 0xbb3f80 &#x27;x&#x27; &#x27;int&#x27;</span><br><span class="line">|-FunctionDecl 0xbb4258 &lt;line:14:1, line:17:1&gt; line:14:6 used printResult &#x27;void (double)&#x27;</span><br><span class="line">| |-ParmVarDecl 0xbb4190 &lt;col:18, col:25&gt; col:25 used radius &#x27;double&#x27;</span><br><span class="line">| `-CompoundStmt 0xbb46a8 &lt;col:33, line:17:1&gt;</span><br><span class="line">|   |-DeclStmt 0xbb44b0 &lt;line:15:5, col:38&gt;</span><br><span class="line">|   | `-VarDecl 0xbb4318 &lt;col:5, col:37&gt; col:12 used area &#x27;double&#x27; cinit</span><br><span class="line">|   |   `-BinaryOperator 0xbb4490 &lt;line:4:12, line:15:37&gt; &#x27;double&#x27; &#x27;*&#x27;</span><br><span class="line">|   |     |-FloatingLiteral 0xbb4380 &lt;line:4:12&gt; &#x27;double&#x27; 3.141593e+00</span><br><span class="line">|   |     `-ImplicitCastExpr 0xbb4478 &lt;line:15:24, col:37&gt; &#x27;double&#x27; &lt;IntegralToFloating&gt;</span><br><span class="line">|   |       `-CallExpr 0xbb4420 &lt;col:24, col:37&gt; &#x27;int&#x27;</span><br><span class="line">|   |         |-ImplicitCastExpr 0xbb4408 &lt;col:24&gt; &#x27;int (*)(int)&#x27; &lt;FunctionToPointerDecay&gt;</span><br><span class="line">|   |         | `-DeclRefExpr 0xbb43a0 &lt;col:24&gt; &#x27;int (int)&#x27; Function 0xbb4018 &#x27;square&#x27; &#x27;int (int)&#x27;</span><br><span class="line">|   |         `-ImplicitCastExpr 0xbb4460 &lt;col:31&gt; &#x27;int&#x27; &lt;FloatingToIntegral&gt;</span><br><span class="line">|   |           `-ImplicitCastExpr 0xbb4448 &lt;col:31&gt; &#x27;double&#x27; &lt;LValueToRValue&gt;</span><br><span class="line">|   |             `-DeclRefExpr 0xbb43c0 &lt;col:31&gt; &#x27;double&#x27; lvalue ParmVar 0xbb4190 &#x27;radius&#x27; &#x27;double&#x27;</span><br><span class="line">|   `-CallExpr 0xbb4610 &lt;line:16:5, col:73&gt; &#x27;int&#x27;</span><br><span class="line">|     |-ImplicitCastExpr 0xbb45f8 &lt;col:5&gt; &#x27;int (*)(const char *, ...)&#x27; &lt;FunctionToPointerDecay&gt;</span><br><span class="line">|     | `-DeclRefExpr 0xbb44c8 &lt;col:5&gt; &#x27;int (const char *, ...)&#x27; Function 0xb083e8 &#x27;printf&#x27; &#x27;int (const char *, ...)&#x27;</span><br><span class="line">|     |-ImplicitCastExpr 0xbb4660 &lt;col:12&gt; &#x27;const char *&#x27; &lt;NoOp&gt;</span><br><span class="line">|     | `-ImplicitCastExpr 0xbb4648 &lt;col:12&gt; &#x27;char *&#x27; &lt;ArrayToPointerDecay&gt;</span><br><span class="line">|     |   `-StringLiteral 0xbb4528 &lt;col:12&gt; &#x27;char[45]&#x27; lvalue &quot;Area of the circle with radius %.2f is %.2f\n&quot;</span><br><span class="line">|     |-ImplicitCastExpr 0xbb4678 &lt;col:61&gt; &#x27;double&#x27; &lt;LValueToRValue&gt;</span><br><span class="line">|     | `-DeclRefExpr 0xbb4570 &lt;col:61&gt; &#x27;double&#x27; lvalue ParmVar 0xbb4190 &#x27;radius&#x27; &#x27;double&#x27;</span><br><span class="line">|     `-ImplicitCastExpr 0xbb4690 &lt;col:69&gt; &#x27;double&#x27; &lt;LValueToRValue&gt;</span><br><span class="line">|       `-DeclRefExpr 0xbb4590 &lt;col:69&gt; &#x27;double&#x27; lvalue Var 0xbb4318 &#x27;area&#x27; &#x27;double&#x27;</span><br><span class="line">`-FunctionDecl 0xbb4720 &lt;line:19:1, line:29:1&gt; line:19:5 main &#x27;int ()&#x27;</span><br><span class="line">  `-CompoundStmt 0xbb4d78 &lt;col:12, line:29:1&gt;</span><br><span class="line">    |-DeclStmt 0xbb4860 &lt;line:20:5, col:24&gt;</span><br><span class="line">    | `-VarDecl 0xbb47d8 &lt;col:5, col:21&gt; col:12 used radius &#x27;double&#x27; cinit</span><br><span class="line">    |   `-FloatingLiteral 0xbb4840 &lt;col:21&gt; &#x27;double&#x27; 5.000000e+00</span><br><span class="line">    |-CallExpr 0xbb4900 &lt;line:21:5, col:23&gt; &#x27;void&#x27;</span><br><span class="line">    | |-ImplicitCastExpr 0xbb48e8 &lt;col:5&gt; &#x27;void (*)(double)&#x27; &lt;FunctionToPointerDecay&gt;</span><br><span class="line">    | | `-DeclRefExpr 0xbb4878 &lt;col:5&gt; &#x27;void (double)&#x27; Function 0xbb4258 &#x27;printResult&#x27; &#x27;void (double)&#x27;</span><br><span class="line">    | `-ImplicitCastExpr 0xbb4928 &lt;col:17&gt; &#x27;double&#x27; &lt;LValueToRValue&gt;</span><br><span class="line">    |   `-DeclRefExpr 0xbb4898 &lt;col:17&gt; &#x27;double&#x27; lvalue Var 0xbb47d8 &#x27;radius&#x27; &#x27;double&#x27;</span><br><span class="line">    |-ForStmt 0xbb4bb8 &lt;line:23:5, line:25:5&gt;</span><br><span class="line">    | |-DeclStmt 0xbb49e0 &lt;line:23:10, col:19&gt;</span><br><span class="line">    | | `-VarDecl 0xbb4958 &lt;col:10, col:18&gt; col:14 used i &#x27;int&#x27; cinit</span><br><span class="line">    | |   `-IntegerLiteral 0xbb49c0 &lt;col:18&gt; &#x27;int&#x27; 0</span><br><span class="line">    | |-&lt;&lt;&lt;NULL&gt;&gt;&gt;</span><br><span class="line">    | |-BinaryOperator 0xbb4a68 &lt;col:21, col:25&gt; &#x27;int&#x27; &#x27;&lt;&#x27;</span><br><span class="line">    | | |-ImplicitCastExpr 0xbb4a38 &lt;col:21&gt; &#x27;int&#x27; &lt;LValueToRValue&gt;</span><br><span class="line">    | | | `-DeclRefExpr 0xbb49f8 &lt;col:21&gt; &#x27;int&#x27; lvalue Var 0xbb4958 &#x27;i&#x27; &#x27;int&#x27;</span><br><span class="line">    | | `-ImplicitCastExpr 0xbb4a50 &lt;col:25&gt; &#x27;int&#x27; &lt;LValueToRValue&gt;</span><br><span class="line">    | |   `-DeclRefExpr 0xbb4a18 &lt;col:25&gt; &#x27;const int&#x27; lvalue Var 0xbad2f8 &#x27;maxValue&#x27; &#x27;const int&#x27;</span><br><span class="line">    | |-UnaryOperator 0xbb4b00 &lt;col:35, col:36&gt; &#x27;int&#x27; postfix &#x27;++&#x27;</span><br><span class="line">    | | `-DeclRefExpr 0xbb4ae0 &lt;col:35&gt; &#x27;int&#x27; lvalue Var 0xbb4958 &#x27;i&#x27; &#x27;int&#x27;</span><br><span class="line">    | `-CompoundStmt 0xbb4ba0 &lt;col:40, line:25:5&gt;</span><br><span class="line">    |   `-CompoundAssignOperator 0xbb4b70 &lt;line:24:9, col:22&gt; &#x27;int&#x27; &#x27;+=&#x27; ComputeLHSTy=&#x27;int&#x27; ComputeResultTy=&#x27;int&#x27;</span><br><span class="line">    |     |-DeclRefExpr 0xbb4b18 &lt;col:9&gt; &#x27;int&#x27; lvalue Var 0xbad398 &#x27;globalVar&#x27; &#x27;int&#x27;</span><br><span class="line">    |     `-ImplicitCastExpr 0xbb4b58 &lt;col:22&gt; &#x27;int&#x27; &lt;LValueToRValue&gt;</span><br><span class="line">    |       `-DeclRefExpr 0xbb4b38 &lt;col:22&gt; &#x27;int&#x27; lvalue Var 0xbb4958 &#x27;i&#x27; &#x27;int&#x27;</span><br><span class="line">    |-CallExpr 0xbb4cd0 &lt;line:26:5, col:52&gt; &#x27;int&#x27;</span><br><span class="line">    | |-ImplicitCastExpr 0xbb4cb8 &lt;col:5&gt; &#x27;int (*)(const char *, ...)&#x27; &lt;FunctionToPointerDecay&gt;</span><br><span class="line">    | | `-DeclRefExpr 0xbb4bf0 &lt;col:5&gt; &#x27;int (const char *, ...)&#x27; Function 0xb083e8 &#x27;printf&#x27; &#x27;int (const char *, ...)&#x27;</span><br><span class="line">    | |-ImplicitCastExpr 0xbb4d18 &lt;col:12&gt; &#x27;const char *&#x27; &lt;NoOp&gt;</span><br><span class="line">    | | `-ImplicitCastExpr 0xbb4d00 &lt;col:12&gt; &#x27;char *&#x27; &lt;ArrayToPointerDecay&gt;</span><br><span class="line">    | |   `-StringLiteral 0xbb4c48 &lt;col:12&gt; &#x27;char[27]&#x27; lvalue &quot;Final globalVar value: %d\n&quot;</span><br><span class="line">    | `-ImplicitCastExpr 0xbb4d30 &lt;col:43&gt; &#x27;int&#x27; &lt;LValueToRValue&gt;</span><br><span class="line">    |   `-DeclRefExpr 0xbb4c80 &lt;col:43&gt; &#x27;int&#x27; lvalue Var 0xbad398 &#x27;globalVar&#x27; &#x27;int&#x27;</span><br><span class="line">    `-ReturnStmt 0xbb4d68 &lt;line:28:5, col:12&gt;</span><br><span class="line">      `-IntegerLiteral 0xbb4d48 &lt;col:12&gt; &#x27;int&#x27; 0</span><br></pre></td></tr></table></figure>

<h3 id="4中间代码生成"><a href="#4中间代码生成" class="headerlink" title="4中间代码生成"></a>4<strong>中间代码生成</strong></h3><blockquote>
<p>ir是后端的开始，可以进行代码的优化，最终生成最终的汇编代码。</p>
<p>有了ir，那么为每一种os设计语言就不用考虑后端了，就直接涉及前端即可，只要能生成一样的ir格式。</p>
</blockquote>
<h4 id="无优化"><a href="#无优化" class="headerlink" title="无优化"></a>无优化</h4><blockquote>
<p>clang -S -emit-llvm -fno-discard-value-names ex.c -o ex.ll -O0 -g0</p>
<p>格式和汇编差不多，但是寄存器数量是不受限制的，采用三地址码的格式，但是同一条指令相同寄存器，不能又做源又做汇编。</p>
<p>其中一开始是全局变量的定义，之后分别是函数声明和定义，文件最开头是架构信息为可选项，文件末尾则是一些个函数属性，函数利用#0，#1来选择是哪一个</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">; ModuleID = &#x27;ex.c&#x27;</span><br><span class="line">source_filename = &quot;ex.c&quot;</span><br><span class="line">target datalayout = &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;</span><br><span class="line">target triple = &quot;x86_64-pc-linux-gnu&quot;</span><br><span class="line"></span><br><span class="line">@maxValue = dso_local constant i32 100, align 4</span><br><span class="line">@globalVar = dso_local global i32 10, align 4</span><br><span class="line">@.str = private unnamed_addr constant [45 x i8] c&quot;Area of the circle with radius %.2f is %.2f\0A\00&quot;, align 1</span><br><span class="line">@.str.1 = private unnamed_addr constant [27 x i8] c&quot;Final globalVar value: %d\0A\00&quot;, align 1</span><br><span class="line"></span><br><span class="line">; Function Attrs: noinline nounwind optnone uwtable</span><br><span class="line">define dso_local i32 @square(i32 noundef %x) #0 &#123;</span><br><span class="line">entry:</span><br><span class="line">  %x.addr = alloca i32, align 4</span><br><span class="line">  store i32 %x, i32* %x.addr, align 4</span><br><span class="line">  %0 = load i32, i32* %x.addr, align 4</span><br><span class="line">  %1 = load i32, i32* %x.addr, align 4</span><br><span class="line">  %mul = mul nsw i32 %0, %1</span><br><span class="line">  ret i32 %mul</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">; Function Attrs: noinline nounwind optnone uwtable</span><br><span class="line">define dso_local void @printResult(double noundef %radius) #0 &#123;</span><br><span class="line">entry:</span><br><span class="line">  %radius.addr = alloca double, align 8</span><br><span class="line">  %area = alloca double, align 8</span><br><span class="line">  store double %radius, double* %radius.addr, align 8</span><br><span class="line">  %0 = load double, double* %radius.addr, align 8</span><br><span class="line">  %conv = fptosi double %0 to i32</span><br><span class="line">  %call = call i32 @square(i32 noundef %conv)</span><br><span class="line">  %conv1 = sitofp i32 %call to double</span><br><span class="line">  %mul = fmul double 0x400921FB54442D18, %conv1</span><br><span class="line">  store double %mul, double* %area, align 8</span><br><span class="line">  %1 = load double, double* %radius.addr, align 8</span><br><span class="line">  %2 = load double, double* %area, align 8</span><br><span class="line">  %call2 = call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([45 x i8], [45 x i8]* @.str, i64 0, i64 0), double noundef %1, double noundef %2)</span><br><span class="line">  ret void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">declare i32 @printf(i8* noundef, ...) #1</span><br><span class="line"></span><br><span class="line">; Function Attrs: noinline nounwind optnone uwtable</span><br><span class="line">define dso_local i32 @main() #0 &#123;</span><br><span class="line">entry:</span><br><span class="line">  %retval = alloca i32, align 4</span><br><span class="line">  %radius = alloca double, align 8</span><br><span class="line">  %i = alloca i32, align 4</span><br><span class="line">  store i32 0, i32* %retval, align 4</span><br><span class="line">  store double 5.000000e+00, double* %radius, align 8</span><br><span class="line">  %0 = load double, double* %radius, align 8</span><br><span class="line">  call void @printResult(double noundef %0)</span><br><span class="line">  store i32 0, i32* %i, align 4</span><br><span class="line">  br label %for.cond</span><br><span class="line"></span><br><span class="line">for.cond:                                         ; preds = %for.inc, %entry</span><br><span class="line">  %1 = load i32, i32* %i, align 4</span><br><span class="line">  %cmp = icmp slt i32 %1, 100</span><br><span class="line">  br i1 %cmp, label %for.body, label %for.end</span><br><span class="line"></span><br><span class="line">for.body:                                         ; preds = %for.cond</span><br><span class="line">  %2 = load i32, i32* %i, align 4</span><br><span class="line">  %3 = load i32, i32* @globalVar, align 4</span><br><span class="line">  %add = add nsw i32 %3, %2</span><br><span class="line">  store i32 %add, i32* @globalVar, align 4</span><br><span class="line">  br label %for.inc</span><br><span class="line"></span><br><span class="line">for.inc:                                          ; preds = %for.body</span><br><span class="line">  %4 = load i32, i32* %i, align 4</span><br><span class="line">  %inc = add nsw i32 %4, 1</span><br><span class="line">  store i32 %inc, i32* %i, align 4</span><br><span class="line">  br label %for.cond, !llvm.loop !6</span><br><span class="line"></span><br><span class="line">for.end:                                          ; preds = %for.cond</span><br><span class="line">  %5 = load i32, i32* @globalVar, align 4</span><br><span class="line">  %call = call i32 (i8*, ...) @printf(i8* noundef getelementptr inbounds ([27 x i8], [27 x i8]* @.str.1, i64 0, i64 0), i32 noundef %5)</span><br><span class="line">  ret i32 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">attributes #0 = &#123; noinline nounwind optnone uwtable &quot;frame-pointer&quot;=&quot;all&quot; &quot;min-legal-vector-width&quot;=&quot;0&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line">attributes #1 = &#123; &quot;frame-pointer&quot;=&quot;all&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line"></span><br><span class="line">!llvm.module.flags = !&#123;!0, !1, !2, !3, !4&#125;</span><br><span class="line">!llvm.ident = !&#123;!5&#125;</span><br><span class="line"></span><br><span class="line">!0 = !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;</span><br><span class="line">!1 = !&#123;i32 7, !&quot;PIC Level&quot;, i32 2&#125;</span><br><span class="line">!2 = !&#123;i32 7, !&quot;PIE Level&quot;, i32 2&#125;</span><br><span class="line">!3 = !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125;</span><br><span class="line">!4 = !&#123;i32 7, !&quot;frame-pointer&quot;, i32 2&#125;</span><br><span class="line">!5 = !&#123;!&quot;Ubuntu clang version 14.0.0-1ubuntu1.1&quot;&#125;</span><br><span class="line">!6 = distinct !&#123;!6, !7&#125;</span><br><span class="line">!7 = !&#123;!&quot;llvm.loop.mustprogress&quot;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="O1优化"><a href="#O1优化" class="headerlink" title="O1优化"></a>O1优化</h4><blockquote>
<p>可以看出代码少了很多,主要优化部分在main以及print函数，优化点在参数的存储那一部分，无优化的时候每次调用函数的时候都会把参数存放在寄存器中</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">; ModuleID = &#x27;ex.c&#x27;</span><br><span class="line">source_filename = &quot;ex.c&quot;</span><br><span class="line">target datalayout = &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;</span><br><span class="line">target triple = &quot;x86_64-pc-linux-gnu&quot;</span><br><span class="line"></span><br><span class="line">@maxValue = dso_local local_unnamed_addr constant i32 100, align 4</span><br><span class="line">@globalVar = dso_local local_unnamed_addr global i32 10, align 4</span><br><span class="line">@.str = private unnamed_addr constant [45 x i8] c&quot;Area of the circle with radius %.2f is %.2f\0A\00&quot;, align 1</span><br><span class="line">@.str.1 = private unnamed_addr constant [27 x i8] c&quot;Final globalVar value: %d\0A\00&quot;, align 1</span><br><span class="line"></span><br><span class="line">; Function Attrs: mustprogress nofree norecurse nosync nounwind readnone uwtable willreturn</span><br><span class="line">define dso_local i32 @square(i32 noundef %x) local_unnamed_addr #0 &#123;</span><br><span class="line">entry:</span><br><span class="line">  %mul = mul nsw i32 %x, %x</span><br><span class="line">  ret i32 %mul</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">; Function Attrs: nofree nounwind uwtable</span><br><span class="line">define dso_local void @printResult(double noundef %radius) local_unnamed_addr #1 &#123;</span><br><span class="line">entry:</span><br><span class="line">  %conv = fptosi double %radius to i32</span><br><span class="line">  %mul.i = mul nsw i32 %conv, %conv</span><br><span class="line">  %conv1 = sitofp i32 %mul.i to double</span><br><span class="line">  %mul = fmul double %conv1, 0x400921FB54442D18</span><br><span class="line">  %call2 = call i32 (i8*, ...) @printf(i8* noundef nonnull dereferenceable(1) getelementptr inbounds ([45 x i8], [45 x i8]* @.str, i64 0, i64 0), double noundef %radius, double noundef %mul)</span><br><span class="line">  ret void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">; Function Attrs: nofree nounwind</span><br><span class="line">declare noundef i32 @printf(i8* nocapture noundef readonly, ...) local_unnamed_addr #2</span><br><span class="line"></span><br><span class="line">; Function Attrs: nofree nounwind uwtable</span><br><span class="line">define dso_local i32 @main() local_unnamed_addr #1 &#123;</span><br><span class="line">entry:</span><br><span class="line">  %call2.i = call i32 (i8*, ...) @printf(i8* noundef nonnull dereferenceable(1) getelementptr inbounds ([45 x i8], [45 x i8]* @.str, i64 0, i64 0), double noundef 5.000000e+00, double noundef 0x4053A28C59D5433B) #3</span><br><span class="line">  %globalVar.promoted = load i32, i32* @globalVar, align 4, !tbaa !5</span><br><span class="line">  %0 = add i32 %globalVar.promoted, 4950</span><br><span class="line">  store i32 %0, i32* @globalVar, align 4, !tbaa !5</span><br><span class="line">  %call = call i32 (i8*, ...) @printf(i8* noundef nonnull dereferenceable(1) getelementptr inbounds ([27 x i8], [27 x i8]* @.str.1, i64 0, i64 0), i32 noundef %0)</span><br><span class="line">  ret i32 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">attributes #0 = &#123; mustprogress nofree norecurse nosync nounwind readnone uwtable willreturn &quot;frame-pointer&quot;=&quot;none&quot; &quot;min-legal-vector-width&quot;=&quot;0&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line">attributes #1 = &#123; nofree nounwind uwtable &quot;frame-pointer&quot;=&quot;none&quot; &quot;min-legal-vector-width&quot;=&quot;0&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line">attributes #2 = &#123; nofree nounwind &quot;frame-pointer&quot;=&quot;none&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line">attributes #3 = &#123; nounwind &#125;</span><br><span class="line"></span><br><span class="line">!llvm.module.flags = !&#123;!0, !1, !2, !3&#125;</span><br><span class="line">!llvm.ident = !&#123;!4&#125;</span><br><span class="line"></span><br><span class="line">!0 = !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;</span><br><span class="line">!1 = !&#123;i32 7, !&quot;PIC Level&quot;, i32 2&#125;</span><br><span class="line">!2 = !&#123;i32 7, !&quot;PIE Level&quot;, i32 2&#125;</span><br><span class="line">!3 = !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125;</span><br><span class="line">!4 = !&#123;!&quot;Ubuntu clang version 14.0.0-1ubuntu1.1&quot;&#125;</span><br><span class="line">!5 = !&#123;!6, !6, i64 0&#125;</span><br><span class="line">!6 = !&#123;!&quot;int&quot;, !7, i64 0&#125;</span><br><span class="line">!7 = !&#123;!&quot;omnipotent char&quot;, !8, i64 0&#125;</span><br><span class="line">!8 = !&#123;!&quot;Simple C/C++ TBAA&quot;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="O2优化"><a href="#O2优化" class="headerlink" title="O2优化"></a>O2优化</h4><blockquote>
<p>感觉已经和O1没什么区别了,应该优化到尽头了</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">; ModuleID = &#x27;ex.c&#x27;</span><br><span class="line">source_filename = &quot;ex.c&quot;</span><br><span class="line">target datalayout = &quot;e-m:e-p270:32:32-p271:32:32-p272:64:64-i64:64-f80:128-n8:16:32:64-S128&quot;</span><br><span class="line">target triple = &quot;x86_64-pc-linux-gnu&quot;</span><br><span class="line"></span><br><span class="line">@maxValue = dso_local local_unnamed_addr constant i32 100, align 4</span><br><span class="line">@globalVar = dso_local local_unnamed_addr global i32 10, align 4</span><br><span class="line">@.str = private unnamed_addr constant [45 x i8] c&quot;Area of the circle with radius %.2f is %.2f\0A\00&quot;, align 1</span><br><span class="line">@.str.1 = private unnamed_addr constant [27 x i8] c&quot;Final globalVar value: %d\0A\00&quot;, align 1</span><br><span class="line"></span><br><span class="line">; Function Attrs: mustprogress nofree norecurse nosync nounwind readnone uwtable willreturn</span><br><span class="line">define dso_local i32 @square(i32 noundef %x) local_unnamed_addr #0 &#123;</span><br><span class="line">entry:</span><br><span class="line">  %mul = mul nsw i32 %x, %x</span><br><span class="line">  ret i32 %mul</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">; Function Attrs: nofree nounwind uwtable</span><br><span class="line">define dso_local void @printResult(double noundef %radius) local_unnamed_addr #1 &#123;</span><br><span class="line">entry:</span><br><span class="line">  %conv = fptosi double %radius to i32</span><br><span class="line">  %mul.i = mul nsw i32 %conv, %conv</span><br><span class="line">  %conv1 = sitofp i32 %mul.i to double</span><br><span class="line">  %mul = fmul double %conv1, 0x400921FB54442D18</span><br><span class="line">  %call2 = call i32 (i8*, ...) @printf(i8* noundef nonnull dereferenceable(1) getelementptr inbounds ([45 x i8], [45 x i8]* @.str, i64 0, i64 0), double noundef %radius, double noundef %mul)</span><br><span class="line">  ret void</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">; Function Attrs: nofree nounwind</span><br><span class="line">declare noundef i32 @printf(i8* nocapture noundef readonly, ...) local_unnamed_addr #2</span><br><span class="line"></span><br><span class="line">; Function Attrs: nofree nounwind uwtable</span><br><span class="line">define dso_local i32 @main() local_unnamed_addr #1 &#123;</span><br><span class="line">entry:</span><br><span class="line">  %call2.i = call i32 (i8*, ...) @printf(i8* noundef nonnull dereferenceable(1) getelementptr inbounds ([45 x i8], [45 x i8]* @.str, i64 0, i64 0), double noundef 5.000000e+00, double noundef 0x4053A28C59D5433B) #3</span><br><span class="line">  %globalVar.promoted = load i32, i32* @globalVar, align 4, !tbaa !5</span><br><span class="line">  %0 = add i32 %globalVar.promoted, 4950</span><br><span class="line">  store i32 %0, i32* @globalVar, align 4, !tbaa !5</span><br><span class="line">  %call = call i32 (i8*, ...) @printf(i8* noundef nonnull dereferenceable(1) getelementptr inbounds ([27 x i8], [27 x i8]* @.str.1, i64 0, i64 0), i32 noundef %0)</span><br><span class="line">  ret i32 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">attributes #0 = &#123; mustprogress nofree norecurse nosync nounwind readnone uwtable willreturn &quot;frame-pointer&quot;=&quot;none&quot; &quot;min-legal-vector-width&quot;=&quot;0&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line">attributes #1 = &#123; nofree nounwind uwtable &quot;frame-pointer&quot;=&quot;none&quot; &quot;min-legal-vector-width&quot;=&quot;0&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line">attributes #2 = &#123; nofree nounwind &quot;frame-pointer&quot;=&quot;none&quot; &quot;no-trapping-math&quot;=&quot;true&quot; &quot;stack-protector-buffer-size&quot;=&quot;8&quot; &quot;target-cpu&quot;=&quot;x86-64&quot; &quot;target-features&quot;=&quot;+cx8,+fxsr,+mmx,+sse,+sse2,+x87&quot; &quot;tune-cpu&quot;=&quot;generic&quot; &#125;</span><br><span class="line">attributes #3 = &#123; nounwind &#125;</span><br><span class="line"></span><br><span class="line">!llvm.module.flags = !&#123;!0, !1, !2, !3&#125;</span><br><span class="line">!llvm.ident = !&#123;!4&#125;</span><br><span class="line"></span><br><span class="line">!0 = !&#123;i32 1, !&quot;wchar_size&quot;, i32 4&#125;</span><br><span class="line">!1 = !&#123;i32 7, !&quot;PIC Level&quot;, i32 2&#125;</span><br><span class="line">!2 = !&#123;i32 7, !&quot;PIE Level&quot;, i32 2&#125;</span><br><span class="line">!3 = !&#123;i32 7, !&quot;uwtable&quot;, i32 1&#125;</span><br><span class="line">!4 = !&#123;!&quot;Ubuntu clang version 14.0.0-1ubuntu1.1&quot;&#125;</span><br><span class="line">!5 = !&#123;!6, !6, i64 0&#125;</span><br><span class="line">!6 = !&#123;!&quot;int&quot;, !7, i64 0&#125;</span><br><span class="line">!7 = !&#123;!&quot;omnipotent char&quot;, !8, i64 0&#125;</span><br><span class="line">!8 = !&#123;!&quot;Simple C/C++ TBAA&quot;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="5汇编代码生成"><a href="#5汇编代码生成" class="headerlink" title="5汇编代码生成"></a>5<strong>汇编代码生成</strong></h3><h4 id="无优化-1"><a href="#无优化-1" class="headerlink" title="无优化"></a>无优化</h4><blockquote>
<p>非常正常的汇编代码，其中定义了每个section，其符合pic的规范，生成的目标文件需要经过got表的重定位（主要涉及到printf函数<code>callq	printf@PLT</code>）。</p>
<p>PLT会经过got表的重定位，来装载符号地址。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">	.text</span><br><span class="line">	.file	&quot;ex.c&quot;</span><br><span class="line">	.globl	square                          # -- Begin function square</span><br><span class="line">	.p2align	4, 0x90</span><br><span class="line">	.type	square,@function</span><br><span class="line">square:                                 # @square</span><br><span class="line">	.cfi_startproc</span><br><span class="line"># %bb.0:                                # %entry</span><br><span class="line">	pushq	%rbp</span><br><span class="line">	.cfi_def_cfa_offset 16</span><br><span class="line">	.cfi_offset %rbp, -16</span><br><span class="line">	movq	%rsp, %rbp</span><br><span class="line">	.cfi_def_cfa_register %rbp</span><br><span class="line">	movl	%edi, -4(%rbp)</span><br><span class="line">	movl	-4(%rbp), %eax</span><br><span class="line">	imull	-4(%rbp), %eax</span><br><span class="line">	popq	%rbp</span><br><span class="line">	.cfi_def_cfa %rsp, 8</span><br><span class="line">	retq</span><br><span class="line">.Lfunc_end0:</span><br><span class="line">	.size	square, .Lfunc_end0-square</span><br><span class="line">	.cfi_endproc</span><br><span class="line">                                        # -- End function</span><br><span class="line">	.section	.rodata.cst8,&quot;aM&quot;,@progbits,8</span><br><span class="line">	.p2align	3                               # -- Begin function printResult</span><br><span class="line">.LCPI1_0:</span><br><span class="line">	.quad	0x400921fb54442d18              # double 3.1415926535897931</span><br><span class="line">	.text</span><br><span class="line">	.globl	printResult</span><br><span class="line">	.p2align	4, 0x90</span><br><span class="line">	.type	printResult,@function</span><br><span class="line">printResult:                            # @printResult</span><br><span class="line">	.cfi_startproc</span><br><span class="line"># %bb.0:                                # %entry</span><br><span class="line">	pushq	%rbp</span><br><span class="line">	.cfi_def_cfa_offset 16</span><br><span class="line">	.cfi_offset %rbp, -16</span><br><span class="line">	movq	%rsp, %rbp</span><br><span class="line">	.cfi_def_cfa_register %rbp</span><br><span class="line">	subq	$16, %rsp</span><br><span class="line">	movsd	%xmm0, -8(%rbp)</span><br><span class="line">	cvttsd2si	-8(%rbp), %edi</span><br><span class="line">	callq	square</span><br><span class="line">	cvtsi2sd	%eax, %xmm0</span><br><span class="line">	movsd	.LCPI1_0(%rip), %xmm1           # xmm1 = mem[0],zero</span><br><span class="line">	mulsd	%xmm0, %xmm1</span><br><span class="line">	movsd	%xmm1, -16(%rbp)</span><br><span class="line">	movsd	-8(%rbp), %xmm0                 # xmm0 = mem[0],zero</span><br><span class="line">	movsd	-16(%rbp), %xmm1                # xmm1 = mem[0],zero</span><br><span class="line">	movabsq	$.L.str, %rdi</span><br><span class="line">	movb	$2, %al</span><br><span class="line">	callq	printf@PLT</span><br><span class="line">	addq	$16, %rsp</span><br><span class="line">	popq	%rbp</span><br><span class="line">	.cfi_def_cfa %rsp, 8</span><br><span class="line">	retq</span><br><span class="line">.Lfunc_end1:</span><br><span class="line">	.size	printResult, .Lfunc_end1-printResult</span><br><span class="line">	.cfi_endproc</span><br><span class="line">                                        # -- End function</span><br><span class="line">	.section	.rodata.cst8,&quot;aM&quot;,@progbits,8</span><br><span class="line">	.p2align	3                               # -- Begin function main</span><br><span class="line">.LCPI2_0:</span><br><span class="line">	.quad	0x4014000000000000              # double 5</span><br><span class="line">	.text</span><br><span class="line">	.globl	main</span><br><span class="line">	.p2align	4, 0x90</span><br><span class="line">	.type	main,@function</span><br><span class="line">main:                                   # @main</span><br><span class="line">	.cfi_startproc</span><br><span class="line"># %bb.0:                                # %entry</span><br><span class="line">	pushq	%rbp</span><br><span class="line">	.cfi_def_cfa_offset 16</span><br><span class="line">	.cfi_offset %rbp, -16</span><br><span class="line">	movq	%rsp, %rbp</span><br><span class="line">	.cfi_def_cfa_register %rbp</span><br><span class="line">	subq	$32, %rsp</span><br><span class="line">	movl	$0, -20(%rbp)</span><br><span class="line">	movsd	.LCPI2_0(%rip), %xmm0           # xmm0 = mem[0],zero</span><br><span class="line">	movsd	%xmm0, -16(%rbp)</span><br><span class="line">	movsd	-16(%rbp), %xmm0                # xmm0 = mem[0],zero</span><br><span class="line">	callq	printResult</span><br><span class="line">	movl	$0, -4(%rbp)</span><br><span class="line">.LBB2_1:                                # %for.cond</span><br><span class="line">                                        # =&gt;This Inner Loop Header: Depth=1</span><br><span class="line">	cmpl	$100, -4(%rbp)</span><br><span class="line">	jge	.LBB2_4</span><br><span class="line"># %bb.2:                                # %for.body</span><br><span class="line">                                        #   in Loop: Header=BB2_1 Depth=1</span><br><span class="line">	movl	-4(%rbp), %eax</span><br><span class="line">	addl	globalVar, %eax</span><br><span class="line">	movl	%eax, globalVar</span><br><span class="line"># %bb.3:                                # %for.inc</span><br><span class="line">                                        #   in Loop: Header=BB2_1 Depth=1</span><br><span class="line">	movl	-4(%rbp), %eax</span><br><span class="line">	addl	$1, %eax</span><br><span class="line">	movl	%eax, -4(%rbp)</span><br><span class="line">	jmp	.LBB2_1</span><br><span class="line">.LBB2_4:                                # %for.end</span><br><span class="line">	movl	globalVar, %esi</span><br><span class="line">	movabsq	$.L.str.1, %rdi</span><br><span class="line">	movb	$0, %al</span><br><span class="line">	callq	printf@PLT</span><br><span class="line">	xorl	%eax, %eax</span><br><span class="line">	addq	$32, %rsp</span><br><span class="line">	popq	%rbp</span><br><span class="line">	.cfi_def_cfa %rsp, 8</span><br><span class="line">	retq</span><br><span class="line">.Lfunc_end2:</span><br><span class="line">	.size	main, .Lfunc_end2-main</span><br><span class="line">	.cfi_endproc</span><br><span class="line">                                        # -- End function</span><br><span class="line">	.type	maxValue,@object                # @maxValue</span><br><span class="line">	.section	.rodata,&quot;a&quot;,@progbits</span><br><span class="line">	.globl	maxValue</span><br><span class="line">	.p2align	2</span><br><span class="line">maxValue:</span><br><span class="line">	.long	100                             # 0x64</span><br><span class="line">	.size	maxValue, 4</span><br><span class="line"></span><br><span class="line">	.type	globalVar,@object               # @globalVar</span><br><span class="line">	.data</span><br><span class="line">	.globl	globalVar</span><br><span class="line">	.p2align	2</span><br><span class="line">globalVar:</span><br><span class="line">	.long	10                              # 0xa</span><br><span class="line">	.size	globalVar, 4</span><br><span class="line"></span><br><span class="line">	.type	.L.str,@object                  # @.str</span><br><span class="line">	.section	.rodata.str1.1,&quot;aMS&quot;,@progbits,1</span><br><span class="line">.L.str:</span><br><span class="line">	.asciz	&quot;Area of the circle with radius %.2f is %.2f\n&quot;</span><br><span class="line">	.size	.L.str, 45</span><br><span class="line"></span><br><span class="line">	.type	.L.str.1,@object                # @.str.1</span><br><span class="line">.L.str.1:</span><br><span class="line">	.asciz	&quot;Final globalVar value: %d\n&quot;</span><br><span class="line">	.size	.L.str.1, 27</span><br><span class="line"></span><br><span class="line">	.ident	&quot;Ubuntu clang version 14.0.0-1ubuntu1.1&quot;</span><br><span class="line">	.section	&quot;.note.GNU-stack&quot;,&quot;&quot;,@progbits</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="O2优化-1"><a href="#O2优化-1" class="headerlink" title="O2优化"></a>O2优化</h4><blockquote>
<p>O1和O2的ir是差不多的，因此这里只显示了其中之一</p>
<p>其中的.标号则是为了pic定位设置的，访问全局变量，访问标号偏移的行对地址，再在相应的地方（got表）进行重定位。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">	.text</span><br><span class="line">	.file	&quot;ex.c&quot;</span><br><span class="line">	.globl	square                          # -- Begin function square</span><br><span class="line">	.p2align	4, 0x90</span><br><span class="line">	.type	square,@function</span><br><span class="line">square:                                 # @square</span><br><span class="line">	.cfi_startproc</span><br><span class="line"># %bb.0:                                # %entry</span><br><span class="line">	movl	%edi, %eax</span><br><span class="line">	imull	%edi, %eax</span><br><span class="line">	retq</span><br><span class="line">.Lfunc_end0:</span><br><span class="line">	.size	square, .Lfunc_end0-square</span><br><span class="line">	.cfi_endproc</span><br><span class="line">                                        # -- End function</span><br><span class="line">	.section	.rodata.cst8,&quot;aM&quot;,@progbits,8</span><br><span class="line">	.p2align	3                               # -- Begin function printResult</span><br><span class="line">.LCPI1_0:</span><br><span class="line">	.quad	0x400921fb54442d18              # double 3.1415926535897931</span><br><span class="line">	.text</span><br><span class="line">	.globl	printResult</span><br><span class="line">	.p2align	4, 0x90</span><br><span class="line">	.type	printResult,@function</span><br><span class="line">printResult:                            # @printResult</span><br><span class="line">	.cfi_startproc</span><br><span class="line"># %bb.0:                                # %entry</span><br><span class="line">	pushq	%rax</span><br><span class="line">	.cfi_def_cfa_offset 16</span><br><span class="line">	cvttsd2si	%xmm0, %eax</span><br><span class="line">	imull	%eax, %eax</span><br><span class="line">	cvtsi2sd	%eax, %xmm1</span><br><span class="line">	mulsd	.LCPI1_0(%rip), %xmm1</span><br><span class="line">	movl	$.L.str, %edi</span><br><span class="line">	movb	$2, %al</span><br><span class="line">	callq	printf@PLT</span><br><span class="line">	popq	%rax</span><br><span class="line">	.cfi_def_cfa_offset 8</span><br><span class="line">	retq</span><br><span class="line">.Lfunc_end1:</span><br><span class="line">	.size	printResult, .Lfunc_end1-printResult</span><br><span class="line">	.cfi_endproc</span><br><span class="line">                                        # -- End function</span><br><span class="line">	.section	.rodata.cst8,&quot;aM&quot;,@progbits,8</span><br><span class="line">	.p2align	3                               # -- Begin function main</span><br><span class="line">.LCPI2_0:</span><br><span class="line">	.quad	0x4014000000000000              # double 5</span><br><span class="line">.LCPI2_1:</span><br><span class="line">	.quad	0x4053a28c59d5433b              # double 78.539816339744831</span><br><span class="line">	.text</span><br><span class="line">	.globl	main</span><br><span class="line">	.p2align	4, 0x90</span><br><span class="line">	.type	main,@function</span><br><span class="line">main:                                   # @main</span><br><span class="line">	.cfi_startproc</span><br><span class="line"># %bb.0:                                # %entry</span><br><span class="line">	pushq	%rax</span><br><span class="line">	.cfi_def_cfa_offset 16</span><br><span class="line">	movsd	.LCPI2_0(%rip), %xmm0           # xmm0 = mem[0],zero</span><br><span class="line">	movsd	.LCPI2_1(%rip), %xmm1           # xmm1 = mem[0],zero</span><br><span class="line">	movl	$.L.str, %edi</span><br><span class="line">	movb	$2, %al</span><br><span class="line">	callq	printf@PLT</span><br><span class="line">	movl	$4950, %esi                     # imm = 0x1356</span><br><span class="line">	addl	globalVar(%rip), %esi</span><br><span class="line">	movl	%esi, globalVar(%rip)</span><br><span class="line">	movl	$.L.str.1, %edi</span><br><span class="line">	xorl	%eax, %eax</span><br><span class="line">	callq	printf@PLT</span><br><span class="line">	xorl	%eax, %eax</span><br><span class="line">	popq	%rcx</span><br><span class="line">	.cfi_def_cfa_offset 8</span><br><span class="line">	retq</span><br><span class="line">.Lfunc_end2:</span><br><span class="line">	.size	main, .Lfunc_end2-main</span><br><span class="line">	.cfi_endproc</span><br><span class="line">                                        # -- End function</span><br><span class="line">	.type	maxValue,@object                # @maxValue</span><br><span class="line">	.section	.rodata,&quot;a&quot;,@progbits</span><br><span class="line">	.globl	maxValue</span><br><span class="line">	.p2align	2</span><br><span class="line">maxValue:</span><br><span class="line">	.long	100                             # 0x64</span><br><span class="line">	.size	maxValue, 4</span><br><span class="line"></span><br><span class="line">	.type	globalVar,@object               # @globalVar</span><br><span class="line">	.data</span><br><span class="line">	.globl	globalVar</span><br><span class="line">	.p2align	2</span><br><span class="line">globalVar:</span><br><span class="line">	.long	10                              # 0xa</span><br><span class="line">	.size	globalVar, 4</span><br><span class="line"></span><br><span class="line">	.type	.L.str,@object                  # @.str</span><br><span class="line">	.section	.rodata.str1.1,&quot;aMS&quot;,@progbits,1</span><br><span class="line">.L.str:</span><br><span class="line">	.asciz	&quot;Area of the circle with radius %.2f is %.2f\n&quot;</span><br><span class="line">	.size	.L.str, 45</span><br><span class="line"></span><br><span class="line">	.type	.L.str.1,@object                # @.str.1</span><br><span class="line">.L.str.1:</span><br><span class="line">	.asciz	&quot;Final globalVar value: %d\n&quot;</span><br><span class="line">	.size	.L.str.1, 27</span><br><span class="line"></span><br><span class="line">	.ident	&quot;Ubuntu clang version 14.0.0-1ubuntu1.1&quot;</span><br><span class="line">	.section	&quot;.note.GNU-stack&quot;,&quot;&quot;,@progbits</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="6-可执行文件生成"><a href="#6-可执行文件生成" class="headerlink" title="6 可执行文件生成"></a>6 可执行文件生成</h3><blockquote>
<p>这里细分可以分为两个步骤，一个是可重定位文件的生成，然后是可执行文件的生成，后者则需要链接器的参与。</p>
<p>前者只是扫描本汇编文件，生成符号表，但是外部符号，也就是定义在其他模块的符号，编译器并不认识，因此需要链接操作。</p>
<p>而链接又分为动态链接，以及静态链接，所谓pic就是相对于动态链接而言的（一个库代码copy处处运行，但是每个程序的虚拟地址映射都是不同的，因此需要运行时装载，应该是一个dlresolve来完成，记不清了），静态链接会一股脑的把目标文件和库文件有用的没用的放到一起，但是动态链接则是用哪个拿那个，因此需要重定位，运行时解析（plt的懒加载），但是一般都是在程序开始时加载got表。（这块很复杂，也不是一两句说的清的）。以下可以看出重定位文件和可执行文件的关系，静态链接没什么可说的，就拿动态链接举例了。</p>
</blockquote>
<blockquote>
<p>可以观察section表，注意和可执行文件的差异，可以看出可执行文件多了plt和got表</p>
</blockquote>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">gcc -c ex.S -o  ex.o</span><br><span class="line">root@L:/home/l/homework/compiler/lab1# readelf -S ex.o</span><br><span class="line">There are 15 section headers, starting at offset 0x558:</span><br><span class="line"></span><br><span class="line">Section Headers:</span><br><span class="line">  [Nr] Name              Type             Address           Offset</span><br><span class="line">       Size              EntSize          Flags  Link  Info  Align</span><br><span class="line">  [ 0]                   NULL             0000000000000000  00000000</span><br><span class="line">       0000000000000000  0000000000000000           0     0     0</span><br><span class="line">  [ 1] .text             PROGBITS         0000000000000000  00000040</span><br><span class="line">       00000000000000cf  0000000000000000  AX       0     0     16</span><br><span class="line">  [ 2] .rela.text        RELA             0000000000000000  00000388</span><br><span class="line">       0000000000000108  0000000000000018   I      12     1     8</span><br><span class="line">  [ 3] .data             PROGBITS         0000000000000000  00000110</span><br><span class="line">       0000000000000004  0000000000000000  WA       0     0     4</span><br><span class="line">  [ 4] .bss              NOBITS           0000000000000000  00000114</span><br><span class="line">       0000000000000000  0000000000000000  WA       0     0     1</span><br><span class="line">  [ 5] .rodata.cst8      PROGBITS         0000000000000000  00000118</span><br><span class="line">       0000000000000010  0000000000000008  AM       0     0     8</span><br><span class="line">  [ 6] .rodata           PROGBITS         0000000000000000  00000128</span><br><span class="line">       0000000000000004  0000000000000000   A       0     0     4</span><br><span class="line">  [ 7] .rodata.str1.1    PROGBITS         0000000000000000  0000012c</span><br><span class="line">       0000000000000048  0000000000000001 AMS       0     0     1</span><br><span class="line">  [ 8] .comment          PROGBITS         0000000000000000  00000174</span><br><span class="line">       0000000000000028  0000000000000001  MS       0     0     1</span><br><span class="line">  [ 9] .note.GNU-stack   PROGBITS         0000000000000000  0000019c</span><br><span class="line">       0000000000000000  0000000000000000           0     0     1</span><br><span class="line">  [10] .eh_frame         PROGBITS         0000000000000000  000001a0</span><br><span class="line">       0000000000000078  0000000000000000   A       0     0     8</span><br><span class="line">  [11] .rela.eh_frame    RELA             0000000000000000  00000490</span><br><span class="line">       0000000000000048  0000000000000018   I      12    10     8</span><br><span class="line">  [12] .symtab           SYMTAB           0000000000000000  00000218</span><br><span class="line">       0000000000000120  0000000000000018          13     6     8</span><br><span class="line">  [13] .strtab           STRTAB           0000000000000000  00000338</span><br><span class="line">       000000000000004a  0000000000000000           0     0     1</span><br><span class="line">  [14] .shstrtab         STRTAB           0000000000000000  000004d8</span><br><span class="line">       000000000000007d  0000000000000000           0     0     1</span><br><span class="line">Key to Flags:</span><br><span class="line">  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),</span><br><span class="line">  L (<span class="built_in">link</span> order), O (extra OS processing required), G (group), T (TLS),</span><br><span class="line">  C (compressed), x (unknown), o (OS specific), E (exclude),</span><br><span class="line">  D (mbind), l (large), p (processor specific)</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">ld -PIE ex.o /usr/lib/x86_64-linux-gnu/crt1.o /usr/lib/x86_64-linux-gnu/crti.o /usr/lib/x86_64-linux-gnu/crtn.o -lc -o ex</span><br><span class="line">root@L:/home/l/homework/compiler/lab1# readelf -S ex</span><br><span class="line">There are 26 section headers, starting at offset 0x3478:</span><br><span class="line"></span><br><span class="line">Section Headers:</span><br><span class="line">  [Nr] Name              Type             Address           Offset</span><br><span class="line">       Size              EntSize          Flags  Link  Info  Align</span><br><span class="line">  [ 0]                   NULL             0000000000000000  00000000</span><br><span class="line">       0000000000000000  0000000000000000           0     0     0</span><br><span class="line">  [ 1] .interp           PROGBITS         00000000004002e0  000002e0</span><br><span class="line">       000000000000000f  0000000000000000   A       0     0     1</span><br><span class="line">  [ 2] .note.gnu.pr[...] NOTE             00000000004002f0  000002f0</span><br><span class="line">       0000000000000020  0000000000000000   A       0     0     8</span><br><span class="line">  [ 3] .note.ABI-tag     NOTE             0000000000400310  00000310</span><br><span class="line">       0000000000000020  0000000000000000   A       0     0     4</span><br><span class="line">  [ 4] .<span class="built_in">hash</span>             HASH             0000000000400330  00000330</span><br><span class="line">       0000000000000024  0000000000000004   A       6     0     8</span><br><span class="line">  [ 5] .gnu.hash         GNU_HASH         0000000000400358  00000358</span><br><span class="line">       000000000000001c  0000000000000000   A       6     0     8</span><br><span class="line">  [ 6] .dynsym           DYNSYM           0000000000400378  00000378</span><br><span class="line">       0000000000000060  0000000000000018   A       7     1     8</span><br><span class="line">  [ 7] .dynstr           STRTAB           00000000004003d8  000003d8</span><br><span class="line">       000000000000004d  0000000000000000   A       0     0     1</span><br><span class="line">  [ 8] .gnu.version      VERSYM           0000000000400426  00000426</span><br><span class="line">       0000000000000008  0000000000000002   A       6     0     2</span><br><span class="line">  [ 9] .gnu.version_r    VERNEED          0000000000400430  00000430</span><br><span class="line">       0000000000000030  0000000000000000   A       7     1     8</span><br><span class="line">  [10] .rela.dyn         RELA             0000000000400460  00000460</span><br><span class="line">       0000000000000030  0000000000000018   A       6     0     8</span><br><span class="line">  [11] .rela.plt         RELA             0000000000400490  00000490</span><br><span class="line">       0000000000000018  0000000000000018  AI       6    20     8</span><br><span class="line">  [12] .init             PROGBITS         0000000000401000  00001000</span><br><span class="line">       000000000000001b  0000000000000000  AX       0     0     4</span><br><span class="line">  [13] .plt              PROGBITS         0000000000401020  00001020</span><br><span class="line">       0000000000000020  0000000000000010  AX       0     0     16</span><br><span class="line">  [14] .text             PROGBITS         0000000000401040  00001040</span><br><span class="line">       0000000000000105  0000000000000000  AX       0     0     16</span><br><span class="line">  [15] .fini             PROGBITS         0000000000401148  00001148</span><br><span class="line">       000000000000000d  0000000000000000  AX       0     0     4</span><br><span class="line">  [16] .rodata           PROGBITS         0000000000402000  00002000</span><br><span class="line">       0000000000000060  0000000000000000   A       0     0     8</span><br><span class="line">  [17] .eh_frame         PROGBITS         0000000000402060  00002060</span><br><span class="line">       00000000000000c8  0000000000000000   A       0     0     8</span><br><span class="line">  [18] .dynamic          DYNAMIC          0000000000403e40  00002e40</span><br><span class="line">       00000000000001b0  0000000000000010  WA       7     0     8</span><br><span class="line">  [19] .got              PROGBITS         0000000000403ff0  00002ff0</span><br><span class="line">       0000000000000010  0000000000000008  WA       0     0     8</span><br><span class="line">  [20] .got.plt          PROGBITS         0000000000404000  00003000</span><br><span class="line">       0000000000000020  0000000000000008  WA       0     0     8</span><br><span class="line">  [21] .data             PROGBITS         0000000000404020  00003020</span><br><span class="line">       0000000000000008  0000000000000000  WA       0     0     4</span><br><span class="line">  [22] .comment          PROGBITS         0000000000000000  00003028</span><br><span class="line">       0000000000000027  0000000000000001  MS       0     0     1</span><br><span class="line">  [23] .symtab           SYMTAB           0000000000000000  00003050</span><br><span class="line">       0000000000000258  0000000000000018          24     7     8</span><br><span class="line">  [24] .strtab           STRTAB           0000000000000000  000032a8</span><br><span class="line">       00000000000000f8  0000000000000000           0     0     1</span><br><span class="line">  [25] .shstrtab         STRTAB           0000000000000000  000033a0</span><br><span class="line">       00000000000000d8  0000000000000000           0     0     1</span><br><span class="line">Key to Flags:</span><br><span class="line">  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),</span><br><span class="line">  L (<span class="built_in">link</span> order), O (extra OS processing required), G (group), T (TLS),</span><br><span class="line">  C (compressed), x (unknown), o (OS specific), E (exclude),</span><br><span class="line">  D (mbind), l (large), p (processor specific)</span><br></pre></td></tr></table></figure>

<h2 id="二-IR编程"><a href="#二-IR编程" class="headerlink" title="二 IR编程"></a>二 IR编程</h2><blockquote>
<p>示例程序</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">main() &#123;</span><br><span class="line">    // 定义变量</span><br><span class="line">    int a, b, i, t, n;</span><br><span class="line"></span><br><span class="line">    // 初始化变量</span><br><span class="line">    a = 0;  // 斐波那契数列的第一个数</span><br><span class="line">    b = 1;  // 斐波那契数列的第二个数</span><br><span class="line">    i = 1;  // 计数器</span><br><span class="line"></span><br><span class="line">    // 输入要生成的斐波那契数列长度</span><br><span class="line">    cin &gt;&gt; n;</span><br><span class="line"></span><br><span class="line">    // 输出斐波那契数列的前两个数字</span><br><span class="line">    cout &lt;&lt; a &lt;&lt; endl;</span><br><span class="line">    cout &lt;&lt; b &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    // 生成斐波那契数列</span><br><span class="line">    while (i &lt; n) &#123;</span><br><span class="line">        t = b;       // 保存当前的 b 值</span><br><span class="line">        b = a + b;   // b 变成下一个斐波那契数</span><br><span class="line">        cout &lt;&lt; b &lt;&lt; endl;  // 输出当前的 b 值</span><br><span class="line">        a = t;       // 更新 a 为上一个的 b 值</span><br><span class="line">        i = i + 1;   // 计数器加 1</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>相应ir代码</p>
<p>SH:</p>
<p>llc -relocation-model&#x3D;pic 2.ll -o main.S</p>
<p>gcc main.S -o two</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">; 模块ID = &#x27;fib.ll&#x27;</span><br><span class="line">; 声明外部函数</span><br><span class="line">declare i32 @scanf(i8*, ...)</span><br><span class="line">declare i32 @printf(i8*, ...)</span><br><span class="line"></span><br><span class="line">; 定义格式化字符串</span><br><span class="line">@.str_in = private unnamed_addr constant [3 x i8] c&quot;%d\00&quot;, align 1    ; 用于输入整数</span><br><span class="line">@.str_out = private unnamed_addr constant [4 x i8] c&quot;%d\0A\00&quot;, align 1 ; 用于输出整数并换行</span><br><span class="line"></span><br><span class="line">; 主函数</span><br><span class="line">define i32 @main() &#123;</span><br><span class="line">entry:</span><br><span class="line">    ; 分配变量的栈空间</span><br><span class="line">    %a = </span><br><span class="line">    i32, align 4    ; int a;</span><br><span class="line">    %b = alloca i32, align 4    ; int b;</span><br><span class="line">    %i = alloca i32, align 4    ; int i;</span><br><span class="line">    %t = alloca i32, align 4    ; int t;</span><br><span class="line">    %n = alloca i32, align 4    ; int n;</span><br><span class="line"></span><br><span class="line">    ; 初始化变量</span><br><span class="line">    store i32 0, i32* %a, align 4    ; a = 0;</span><br><span class="line">    store i32 1, i32* %b, align 4    ; b = 1;</span><br><span class="line">    store i32 1, i32* %i, align 4    ; i = 1;</span><br><span class="line"></span><br><span class="line">    ; 输入要生成的斐波那契数列长度 n</span><br><span class="line">    call i32 (i8*, ...) @scanf(i8* getelementptr inbounds ([3 x i8], [3 x i8]* @.str_in, i32 0, i32 0), i32* %n)</span><br><span class="line"></span><br><span class="line">    ; 输出斐波那契数列的前两个数字</span><br><span class="line">    %a_val = load i32, i32* %a, align 4</span><br><span class="line">    call i32 (i8*, ...) @printf(i8* getelementptr inbounds ([4 x i8], [4 x i8]* @.str_out, i32 0, i32 0), i32 %a_val)</span><br><span class="line">    %b_val = load i32, i32* %b, align 4</span><br><span class="line">    call i32 (i8*, ...) @printf(i8* getelementptr inbounds ([4 x i8], [4 x i8]* @.str_out, i32 0, i32 0), i32 %b_val)</span><br><span class="line"></span><br><span class="line">    ; 进入循环</span><br><span class="line">    br label %loop</span><br><span class="line"></span><br><span class="line">loop:</span><br><span class="line">    ; 加载当前的 i 和 n 的值</span><br><span class="line">    %i_val = load i32, i32* %i, align 4</span><br><span class="line">    %n_val = load i32, i32* %n, align 4</span><br><span class="line">    ; 判断 i 是否小于 n</span><br><span class="line">    %cmp = icmp slt i32 %i_val, %n_val</span><br><span class="line">    ; 根据比较结果跳转</span><br><span class="line">    br i1 %cmp, label %loop_body, label %end</span><br><span class="line"></span><br><span class="line">loop_body:</span><br><span class="line">    ; t = b;</span><br><span class="line">    %b_val2 = load i32, i32* %b, align 4</span><br><span class="line">    store i32 %b_val2, i32* %t, align 4</span><br><span class="line">    ; b = a + b;</span><br><span class="line">    %a_val2 = load i32, i32* %a, align 4</span><br><span class="line">    %sum = add i32 %a_val2, %b_val2</span><br><span class="line">    store i32 %sum, i32* %b, align 4</span><br><span class="line">    ; 输出当前的 b 值</span><br><span class="line">    %b_val3 = load i32, i32* %b, align 4</span><br><span class="line">    call i32 (i8*, ...) @printf(i8* getelementptr inbounds ([4 x i8], [4 x i8]* @.str_out, i32 0, i32 0), i32 %b_val3)</span><br><span class="line">    ; a = t;</span><br><span class="line">    %t_val = load i32, i32* %t, align 4</span><br><span class="line">    store i32 %t_val, i32* %a, align 4</span><br><span class="line">    ; i = i + 1;</span><br><span class="line">    %i_val2 = load i32, i32* %i, align 4</span><br><span class="line">    %inc = add i32 %i_val2, 1</span><br><span class="line">    store i32 %inc, i32* %i, align 4</span><br><span class="line">    ; 返回循环判断</span><br><span class="line">    br label %loop</span><br><span class="line"></span><br><span class="line">end:</span><br><span class="line">    ; 函数返回</span><br><span class="line">    ret i32 0</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>输出示例：</p>
</blockquote>
<p><img src="/img/mypic/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/image-20240917191630045.png" alt="image-20240917191630045"></p>
<h2 id="三-汇编编程"><a href="#三-汇编编程" class="headerlink" title="三 汇编编程"></a>三 汇编编程</h2><blockquote>
<p>SH:</p>
<p>riscv64-unknown-linux-gnu-gcc -o three three.S -static</p>
<p>qemu-riscv64 .&#x2F;three</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">    .data</span><br><span class="line"># scanf 和 printf 的格式字符串</span><br><span class="line">input_fmt:    .asciz &quot;%d&quot;       # 读取整数的格式字符串</span><br><span class="line">output_fmt:   .asciz &quot;%d\n&quot;     # 输出带换行符的整数的格式字符串</span><br><span class="line"></span><br><span class="line">    .text</span><br><span class="line">    .global main</span><br><span class="line">main:</span><br><span class="line">    # 设置栈帧</span><br><span class="line">    addi sp, sp, -32           # 分配 32 字节的栈空间用于变量和保存的寄存器</span><br><span class="line">    sw ra, 28(sp)              # 保存返回地址</span><br><span class="line">    sw s0, 24(sp)              # 保存帧指针</span><br><span class="line">    addi s0, sp, 32            # 设置帧指针 (s0) 为栈帧的顶部</span><br><span class="line"></span><br><span class="line">    # 为变量 a, b, i, t, n 分配空间</span><br><span class="line">    # 通过从 s0 的偏移量访问变量：</span><br><span class="line">    # a: -20(s0)</span><br><span class="line">    # b: -16(s0)</span><br><span class="line">    # i: -12(s0)</span><br><span class="line">    # t: -8(s0)</span><br><span class="line">    # n: -4(s0)</span><br><span class="line"></span><br><span class="line">    # 初始化变量</span><br><span class="line">    li t0, 0                   # 将立即数 0 加载到 t0 中</span><br><span class="line">    sw t0, -20(s0)             # 将 t0 存储到 a 中 (a = 0)</span><br><span class="line">    li t0, 1                   # 将立即数 1 加载到 t0 中</span><br><span class="line">    sw t0, -16(s0)             # 将 t0 存储到 b 中 (b = 1)</span><br><span class="line">    sw t0, -12(s0)             # 将 t0 存储到 i 中 (i = 1)</span><br><span class="line"></span><br><span class="line">    # 从输入中读取 n</span><br><span class="line">    la a0, input_fmt           # 将 input_fmt 的地址加载到 a0 中</span><br><span class="line">    addi a1, s0, -4            # 计算 n 的地址并存入 a1</span><br><span class="line">    call scanf                 # 调用 scanf 读取 n</span><br><span class="line"></span><br><span class="line">    # 输出前两个斐波那契数：a 和 b</span><br><span class="line">    lw t0, -20(s0)             # 将 a 加载到 t0 中</span><br><span class="line">    mv a1, t0                  # 将 t0 移动到 a1（printf 的第一个参数）</span><br><span class="line">    la a0, output_fmt          # 将 output_fmt 的地址加载到 a0 中</span><br><span class="line">    call printf                # 调用 printf 打印 a</span><br><span class="line"></span><br><span class="line">    lw t0, -16(s0)             # 将 b 加载到 t0 中</span><br><span class="line">    mv a1, t0                  # 将 t0 移动到 a1</span><br><span class="line">    la a0, output_fmt</span><br><span class="line">    call printf                # 打印 b</span><br><span class="line"></span><br><span class="line">    # 循环开始</span><br><span class="line">loop_start:</span><br><span class="line">    lw t0, -12(s0)             # 将 i 加载到 t0 中</span><br><span class="line">    lw t1, -4(s0)              # 将 n 加载到 t1 中</span><br><span class="line">    blt t0, t1, loop_body      # 如果 i &lt; n，跳转到 loop_body</span><br><span class="line">    j loop_end                 # 否则，跳转到 loop_end</span><br><span class="line"></span><br><span class="line">loop_body:</span><br><span class="line">    # t = b</span><br><span class="line">    lw t0, -16(s0)             # 将 b 加载到 t0 中</span><br><span class="line">    sw t0, -8(s0)              # 将 t0 存储到 t 中</span><br><span class="line"></span><br><span class="line">    # b = a + b</span><br><span class="line">    lw t0, -20(s0)             # 将 a 加载到 t0 中</span><br><span class="line">    lw t1, -16(s0)             # 将 b 加载到 t1 中</span><br><span class="line">    add t0, t0, t1             # t0 = a + b</span><br><span class="line">    sw t0, -16(s0)             # 将 t0 存储到 b 中 (b = a + b)</span><br><span class="line"></span><br><span class="line">    # 输出新的 b</span><br><span class="line">    mv a1, t0                  # 将新的 b 移动到 a1</span><br><span class="line">    la a0, output_fmt</span><br><span class="line">    call printf                # 打印 b</span><br><span class="line"></span><br><span class="line">    # a = t</span><br><span class="line">    lw t0, -8(s0)              # 将 t 加载到 t0 中</span><br><span class="line">    sw t0, -20(s0)             # 将 t0 存储到 a 中</span><br><span class="line"></span><br><span class="line">    # i = i + 1</span><br><span class="line">    lw t0, -12(s0)             # 将 i 加载到 t0 中</span><br><span class="line">    addi t0, t0, 1             # 增加 t0 (t0 = i + 1)</span><br><span class="line">    sw t0, -12(s0)             # 将 t0 存储回 i</span><br><span class="line"></span><br><span class="line">    j loop_start               # 跳回到循环的开始</span><br><span class="line"></span><br><span class="line">loop_end:</span><br><span class="line">    # 清理栈帧并返回（因无start会发生段错误）</span><br><span class="line">    lw ra, 28(sp)              # 恢复返回地址</span><br><span class="line">    lw s0, 24(sp)              # 恢复帧指针</span><br><span class="line">    addi sp, sp, 32            # 释放栈空间</span><br><span class="line">    ret                        # 从 main 返回</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>结果:</p>
<p>因为没有exit系统调用，因此会直接段错误，但是不影响程序功能。</p>
</blockquote>
<p><img src="/img/mypic/com/image-20240917193239718.png" alt="image-20240917193239718"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>Author: </span><span class="post-copyright-info"><a href="http://example.com">陌影形</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>Link: </span><span class="post-copyright-info"><a href="http://example.com/2024/09/15/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/%E4%BD%9C%E4%B8%9A1/">http://example.com/2024/09/15/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/%E4%BD%9C%E4%B8%9A1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/compiler/">compiler</a></div><div class="post_share"><div class="social-share" data-image="https://avatars.githubusercontent.com/u/162703063?s=400&amp;u=7f599e5661244ad7e8490354a9580880dc56acde&amp;v=4" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/09/15/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/%E8%AF%AD%E4%B9%89%E5%88%86%E6%9E%90/" title="语义分析"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Previous</div><div class="prev_info">语义分析</div></div></a></div><div class="next-post pull-right"><a href="/2024/09/14/linux%E5%86%85%E6%A0%B8/linux5.15%E5%88%86%E6%9E%90/mm/" title="linux5.15之物理内存管理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">Next</div><div class="next_info">linux5.15之物理内存管理</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2024/09/15/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/LLVM%20IR/" title="IR初探"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-15</div><div class="title">IR初探</div></div></a></div><div><a href="/2024/08/01/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86paser%E5%AD%A6%E4%B9%A0/" title="关于parser的语法树生成算法（实现）"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-08-01</div><div class="title">关于parser的语法树生成算法（实现）</div></div></a></div><div><a href="/2024/09/15/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/%E8%AF%AD%E4%B9%89%E5%88%86%E6%9E%90/" title="语义分析"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-09-15</div><div class="title">语义分析</div></div></a></div></div></div><hr class="custom-hr"/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> Comment</span></div></div><div class="comment-wrap"><div><div id="lv-container" data-id="city" data-uid="MTAyMC82MDAzNi8zNjQ5OQ=="></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://avatars.githubusercontent.com/u/162703063?s=400&amp;u=7f599e5661244ad7e8490354a9580880dc56acde&amp;v=4" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">陌影形</div><div class="author-info__description">MYX</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">53</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">17</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">17</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/MoyInGxing"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/MoyInGxing" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80"><span class="toc-number">1.</span> <span class="toc-text">一</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#c-%E7%A4%BA%E4%BE%8B"><span class="toc-number">2.</span> <span class="toc-text">c++示例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E9%A2%84%E5%A4%84%E7%90%86"><span class="toc-number">2.1.</span> <span class="toc-text">1预处理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E8%AF%8D%E6%B3%95%E5%88%86%E6%9E%90"><span class="toc-number">2.2.</span> <span class="toc-text">2词法分析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E8%AF%AD%E6%B3%95%E5%88%86%E6%9E%90%EF%BC%88AST%E7%94%9F%E6%88%90%EF%BC%89"><span class="toc-number">2.3.</span> <span class="toc-text">3语法分析（AST生成）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E4%B8%AD%E9%97%B4%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90"><span class="toc-number">2.4.</span> <span class="toc-text">4中间代码生成</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E4%BC%98%E5%8C%96"><span class="toc-number">2.4.1.</span> <span class="toc-text">无优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#O1%E4%BC%98%E5%8C%96"><span class="toc-number">2.4.2.</span> <span class="toc-text">O1优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#O2%E4%BC%98%E5%8C%96"><span class="toc-number">2.4.3.</span> <span class="toc-text">O2优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E6%B1%87%E7%BC%96%E4%BB%A3%E7%A0%81%E7%94%9F%E6%88%90"><span class="toc-number">2.5.</span> <span class="toc-text">5汇编代码生成</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%A0%E4%BC%98%E5%8C%96-1"><span class="toc-number">2.5.1.</span> <span class="toc-text">无优化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#O2%E4%BC%98%E5%8C%96-1"><span class="toc-number">2.5.2.</span> <span class="toc-text">O2优化</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%E7%94%9F%E6%88%90"><span class="toc-number">2.6.</span> <span class="toc-text">6 可执行文件生成</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-IR%E7%BC%96%E7%A8%8B"><span class="toc-number">3.</span> <span class="toc-text">二 IR编程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-%E6%B1%87%E7%BC%96%E7%BC%96%E7%A8%8B"><span class="toc-number">4.</span> <span class="toc-text">三 汇编编程</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/22/C++/%E7%B1%BB/" title="C++类机制">C++类机制</a><time datetime="2024-09-22T09:45:08.000Z" title="Created 2024-09-22 17:45:08">2024-09-22</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/20/linux%E5%86%85%E6%A0%B8/linux5.15%E5%88%86%E6%9E%90/%E5%85%B3%E4%BA%8Epage%E5%88%86%E9%85%8D/" title="linux5.15之page分配">linux5.15之page分配</a><time datetime="2024-09-20T09:45:08.000Z" title="Created 2024-09-20 17:45:08">2024-09-20</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/19/%E5%AF%86%E7%A0%81%E5%AD%A6/%E4%BF%A1%E6%81%AF%E8%AE%BA/" title="Untitled">Untitled</a><time datetime="2024-09-19T00:40:05.460Z" title="Created 2024-09-19 08:40:05">2024-09-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/17/%E5%AF%86%E7%A0%81%E5%AD%A6/%E5%AE%9E%E6%88%98/" title="密码学实战">密码学实战</a><time datetime="2024-09-17T09:45:08.000Z" title="Created 2024-09-17 17:45:08">2024-09-17</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2024/09/16/linux%E5%86%85%E6%A0%B8/linux5.15%E5%88%86%E6%9E%90/%E5%85%B3%E4%BA%8Epage/" title="linux5.15之page">linux5.15之page</a><time datetime="2024-09-16T09:45:08.000Z" title="Created 2024-09-16 17:45:08">2024-09-16</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('/img/footer.jpg')"><div id="footer-wrap"><div class="copyright">&copy;2024 By 陌影形</div><div class="footer_custom_text">END</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Toggle Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="Scroll To Comments"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>(()=>{
  const loadLivere = () => {
    if (typeof LivereTower === 'object') window.LivereTower.init()
    else {
      (function(d, s) {
          var j, e = d.getElementsByTagName(s)[0];
          if (typeof LivereTower === 'function') { return; }
          j = d.createElement(s);
          j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
          j.async = true;
          e.parentNode.insertBefore(j, e);
      })(document, 'script');
    }
  }

  if ('Livere' === 'Livere' || !false) {
    if (false) btf.loadComment(document.getElementById('lv-container'), loadLivere)
    else loadLivere()
  } else {
    window.loadOtherComment = loadLivere
  }
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>